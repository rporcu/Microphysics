!vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvC
!                                                                      C
!  Module name: USR0                                                   C
!                                                                      C
!  Purpose: This routine is called before the time loop starts and is  C
!           user-definable.  The user may insert code in this routine  C
!           or call appropriate user defined subroutines.  This        C
!           can be used for setting constants and checking errors in   C
!           data.  This routine is not called from an IJK loop, hence  C
!           all indices are undefined.                                 C
!                                                                      C
!^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^C
      SUBROUTINE USR0

      use usr
      use discretelement, only: PARTICLES
      use constant, only: PI
      use compar, only: myPE, PE_IO
      use exit_mod, only: mfix_exit

      IMPLICIT NONE

      INTEGER :: NP
      double precision :: lTMP(62,3)

      IF(PARTICLES /= 93) THEN
         write(*,"(3x, 'invalid setup for test case')")
         call mfix_exit(0)
      ENDIF

      INIT_VEL_T = 0.0d0
      INIT_ANGLE = 0.0d0

! Collect initial translational velocity to IO processor.
      ltmp( 1,:) = (/ 0.000000,  -3.900000,   0.000000/)
      ltmp( 2,:) = (/ 0.000000,  -3.899851,   0.034033/)
      ltmp( 3,:) = (/ 0.014151,  -3.899406,   0.066577/)
      ltmp( 4,:) = (/ 0.041524,  -3.898664,   0.093264/)
      ltmp( 5,:) = (/ 0.080002,  -3.897624,   0.110114/)
      ltmp( 6,:) = (/ 0.126421,  -3.896288,   0.113830/)
      ltmp( 7,:) = (/ 0.294368,  -3.885159,   0.169954/)
      ltmp( 8,:) = (/ 0.484137,  -3.866635,   0.157306/)
      ltmp( 9,:) = (/ 0.673518,  -3.840750,   0.070790/)
      ltmp(10,:) = (/ 0.839490,  -3.807554,  -0.088234/)
      ltmp(11,:) = (/ 0.959991,  -3.767111,  -0.311920/)
      ltmp(12,:) = (/ 1.015634,  -3.719496,  -0.586376/)
      ltmp(13,:) = (/ 0.991265,  -3.664801,  -0.892539/)
      ltmp(14,:) = (/ 0.877249,  -3.603130,  -1.207430/)
      ltmp(15,:) = (/ 0.670388,  -3.534600,  -1.505716/)
      ltmp(16,:) = (/ 0.374411,  -3.459342,  -1.761467/)
      ltmp(17,:) = (/ 0.000000,  -3.377499,  -1.950000/)
      ltmp(18,:) = (/-0.435672,  -3.289227,  -2.049677/)
      ltmp(19,:) = (/-0.909849,  -3.194693,  -2.043554/)
      ltmp(20,:) = (/-1.395502,  -3.094078,  -1.920744/)
      ltmp(21,:) = (/-1.862969,  -2.987573,  -1.677425/)
      ltmp(22,:) = (/-2.281805,  -2.875382,  -1.317401/)
      ltmp(23,:) = (/-2.622744,  -2.757716,  -0.852181/)
      ltmp(24,:) = (/-2.859630,  -2.634802,  -0.300559/)
      ltmp(25,:) = (/-2.971207,  -2.506872,   0.312286/)
      ltmp(26,:) = (/-2.942643,  -2.374170,   0.956123/)
      ltmp(27,:) = (/-2.766685,  -2.236948,   1.597346/)
      ltmp(28,:) = (/-2.444372,  -2.095468,   2.200922/)
      ltmp(29,:) = (/-1.985244,  -1.950000,   2.732454/)
      ltmp(30,:) = (/-1.407041,  -1.800820,   3.160266/)
      ltmp(31,:) = (/-0.734885,  -1.648211,   3.457361/)
      ltmp(32,:) = (/ 0.000000,  -3.900000,   0.000000/)
      ltmp(33,:) = (/ 0.003557,  -3.899851,   0.033847/)
      ltmp(34,:) = (/ 0.021033,  -3.899406,   0.064733/)
      ltmp(35,:) = (/ 0.051045,  -3.898664,   0.088413/)
      ltmp(36,:) = (/ 0.091074,  -3.897624,   0.101148/)
      ltmp(37,:) = (/ 0.137626,  -3.896288,   0.099991/)
      ltmp(38,:) = (/ 0.310521,  -3.885159,   0.138253/)
      ltmp(39,:) = (/ 0.497928,  -3.866635,   0.105838/)
      ltmp(40,:) = (/ 0.677228,  -3.840750,   0.000000/)
      ltmp(41,:) = (/ 0.825669,  -3.807554,  -0.175501/)
      ltmp(42,:) = (/ 0.922128,  -3.767111,  -0.410558/)
      ltmp(43,:) = (/ 0.948777,  -3.719496,  -0.689327/)
      ltmp(44,:) = (/ 0.892539,  -3.664801,  -0.991265/)
      ltmp(45,:) = (/ 0.746233,  -3.603130,  -1.292513/)
      ltmp(46,:) = (/ 0.509325,  -3.534600,  -1.567542/)
      ltmp(47,:) = (/ 0.188237,  -3.459342,  -1.790955/)
      ltmp(48,:) = (/-0.203831,  -3.377499,  -1.939318/)
      ltmp(49,:) = (/-0.647535,  -3.289227,  -1.992909/)
      ltmp(50,:) = (/-1.118474,  -3.194693,  -1.937254/)
      ltmp(51,:) = (/-1.588630,  -3.094078,  -1.764352/)
      ltmp(52,:) = (/-2.028102,  -2.987573,  -1.473502/)
      ltmp(53,:) = (/-2.407011,  -2.875382,  -1.071670/)
      ltmp(54,:) = (/-2.697454,  -2.757716,  -0.573361/)
      ltmp(55,:) = (/-2.875382,  -2.634802,   0.000000/)
      ltmp(56,:) = (/-2.922288,  -2.506872,   0.621151/)
      ltmp(57,:) = (/-2.826581,  -2.374170,   1.258475/)
      ltmp(58,:) = (/-2.584561,  -2.236948,   1.877793/)
      ltmp(59,:) = (/-2.200922,  -2.095468,   2.444372/)
      ltmp(60,:) = (/-1.688750,  -1.950000,   2.925000/)
      ltmp(61,:) = (/-1.068996,  -1.800820,   3.290030/)
      ltmp(62,:) = (/-0.369466,  -1.648211,   3.515237/)



! Store the collision angle and initial tangential velocity
      IF(myPE == PE_IO) THEN
         DO NP=1, 62
            INIT_VEL_T(NP) = sqrt(lTMP(NP,1)**2 + lTMP(NP,3)**2)
            INIT_ANGLE(NP) = abs(atan(INIT_VEL_T(NP)/lTMP(NP,2)))*180.0/PI
         ENDDO
      ENDIF

      return
      END SUBROUTINE USR0
