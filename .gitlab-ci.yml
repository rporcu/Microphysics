# cache:
#   key: "$CI_BUILD_REF_NAME"
#   untracked: true
#   paths:
#     - build/

image: mfixexa

stages:
  - build
  - test
  - benchmarks

build:
  stage: build
  script:
    - mkdir build
    - cd build
    - FC='mpifort -g -std=f2008 -fcheck=all -Wall' cmake -DMPI=1 ..
    - make
    - env CTEST_OUTPUT_ON_FAILURE=1 OMP_NUM_THREADS=4 ctest -R build_
  artifacts:
    paths:
    - build

test:
  stage: test
  script:
    - cd build
    - env CTEST_OUTPUT_ON_FAILURE=1 OMP_NUM_THREADS=4 ctest -R tests


benchmarks:
  stage: benchmarks
  script:
    - mkdir build-benchmarks
    - cd build-benchmarks
    - cmake -DCMAKE_BUILD_TYPE=Release -DMPI=1 ..
    - env CTEST_OUTPUT_ON_FAILURE=1 ctest -R benchmarks
